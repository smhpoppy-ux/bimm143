---
title: "class8miniproj"
author: "sylvia ho a18482382"
format: pdf
toc: true
---

##Background
all techniques so far data analysis: ml clustering, pca to analyze real bc biopsy

##data import
data in csv
```{r}
fna.data<-read.csv("WisconsinCancer.csv")
wisc.df <- data.frame(fna.data, row.names=1)
```

```{r}
head(wisc.df, 4)
```

```{r}
#remove col1
wisc.data <- wisc.df[,-1]
```

```{r}
diagnosis <- wisc.df$diagnosis
```


>q1: 569

```{r}
nrow(wisc.data)
```

>q2: 212

```{r}
sum(diagnosis=="M")
```

>q3: 10

```{r}
length(grep("mean", colnames(wisc.df)))
```

##pca
opt arg `scale=TRUE` since cols/ft/dimensions are diff scales

```{r}
colMeans(wisc.data)

apply(wisc.data,2,sd)
```
>q4 44.27%

```{r}
wisc.pr <- prcomp( wisc.data, scale = T)
summary(wisc.pr)

```

>q5 3

>q6 more than 5

>q7: it is difficult to understand and the thing that stands out is the red and black
```{r}
biplot(wisc.pr)
```

```{r}
library(ggplot2)

ggplot(wisc.pr$x) +
  aes(x=PC1, y=PC2, col=diagnosis) +
  geom_point()
```


>q8 pc1 is showing separation b/m

```{r}
library(ggplot2)

ggplot(wisc.pr$x) +
  aes(x=PC1, y=PC3, col=diagnosis) +
  geom_point()

```

```{r}
pr.var <- wisc.pr$sdev^2
head(pr.var)
pve <- pr.var / sum(pr.var)

# Plot variance explained for each principal component
plot(c(1,pve), xlab = "Principal Component", 
     ylab = "Proportion of Variance Explained", 
     ylim = c(0, 1), type = "o")
```
>q9 large. concavity_mean, perimeter_mean

```{r}
wisc.pr$rotation[,1]
```




##hierarchical clustering
obv grps into m/b ?
scale `wisc.data` then calc dist matrix, pass to `hclust()`

First scale the wisc.data data and assign the result to data.scaled.
```{r}
# Scale the wisc.data data using the "scale()" function
data.scaled <- scale(wisc.data)
```

Next, calculate the (Euclidean) distances between all pairs of observations in the new scaled dataset and assign the result to data.dist.
```{r}
data.dist <- dist(data.scaled)

```


Create a hierarchical clustering model using complete linkage. Manually specify the method argument to hclust() and assign the results to wisc.hclust.

```{r}
wisc.hclust <- hclust(data.dist, method = "complete")

```

>q10 19

```{r}
plot(wisc.hclust)
abline(h = 19, col = "red", lty = 2)
```
```{r}
wisc.hclust.clusters <- cutree(wisc.hclust, k=4)

#We can use the table() function to compare the cluster membership to the actual diagnoses.

table(wisc.hclust.clusters, diagnosis)
```

## combo methods
new vars (pcs) `wisc.pr$x` that are better descriptors of data set than orgi ie 30 cols in `wisc.data` and use as basis for clustering

>q12 Side-note: The method="ward.D2"creates groups such that variance is minimized within clusters. This has the effect of looking for spherical clusters with the process starting with all points in individual clusters (bottom up) and then repeatedly merging a pair of clusters such that when merged there is a minimum increase in total within-cluster variance. This process continues until a single group including all points (the top of the tree) is defined.


```{r}

pc.dist<- dist(wisc.pr$x[,1:3])
wisc.pr.hclust<-hclust(pc.dist, method = "ward.D2")
plot(wisc.pr.hclust)
```

```{r}
grps <- cutree(wisc.pr.hclust, k=2)
table(grps)
```

can run `table()` w both clustering `grps` and expert `diagnosis`

```{r}
table(grps, diagnosis)

```
c1 has 179m, c2 has 333 b
aka

- 179 tp
- 24 fp
- 333 tn
- 33 fn

```{r}
ggplot(wisc.pr$x) +
  aes(PC1, PC2) +
  geom_point(col=grps)
```
```{r}
wisc.pr.hclust <- hclust(dist(wisc.pr$x[, 1:7]), method = "ward.D2")
wisc.pr.hclust.clusters <- cutree(wisc.pr.hclust, k=2)

```
>q13 better but its still pretty high

```{r}
# Compare to actual diagnoses
table(wisc.pr.hclust.clusters, diagnosis)
```
>q14 c1m c3b, pretty good

```{r}
table(wisc.hclust.clusters, diagnosis)
```

sensitivity TP/(TP+FN)
spec: TN/(TN+FP)

```{r}
tp<- 179
fp<- 24
tn<- 333
fn<- 33
sen<-tp/(tp+fn)
spec<-tn/(tn+fp)
sen
spec
```

## prediction
can use model for new cases

```{r}
#url <- "new_samples.csv"
url <- "https://tinyurl.com/new-samples-CSV"
new <- read.csv(url)
npc <- predict(wisc.pr, newdata=new)
npc
```

```{r}
plot(wisc.pr$x[,1:2], col=grps)
points(npc[,1], npc[,2], col="blue", pch=16, cex=3)
text(npc[,1], npc[,2], c(1,2), col="white")
```

>q16 pt 1

```{r}
sessionInfo()

```







